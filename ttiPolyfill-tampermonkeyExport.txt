{"created_by":"Tampermonkey","version":"1","scripts":[{"name":"Time to Interactive Polyfill","options":{"comment":null,"compatopts_for_requires":true,"compat_wrappedjsobject":false,"compat_metadata":false,"compat_foreach":false,"compat_arrayleft":false,"compat_uW_gmonkey":false,"compat_forvarin":false,"noframes":null,"awareOfChrome":false,"run_at":null,"override":{"use_includes":[],"orig_includes":["http://*","https://*"],"merge_includes":true,"use_matches":[],"orig_matches":[],"merge_matches":true,"use_excludes":[],"orig_excludes":[],"merge_excludes":true,"use_connects":[],"merge_connects":true,"use_blockers":[],"orig_run_at":"document-start","orig_noframes":true,"orig_connects":[]}},"storage":{"ts":1493737294261,"data":{}},"enabled":true,"position":1,"uuid":"1cd1dd11-d5fe-4a6c-bffe-1d97014d84da","source":"Ly8gPT1Vc2VyU2NyaXB0PT0KLy8gQG5hbWUgICAgICAgICBUaW1lIHRvIEludGVyYWN0aXZlIFBvbHlmaWxsCi8vIEBuYW1lc3BhY2UgICAgaHR0cDovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS8KLy8gQHZlcnNpb24gICAgICAwLjEKLy8gQGRlc2NyaXB0aW9uICBQb2x5ZmlsbCB0byBkZXRlY3QgVGltZSB0byBJbnRlcmFjdGl2ZQovLyBAYXV0aG9yICAgICAgIERlZXBhbmphbiBSb3kKLy8gQGluY2x1ZGUgICAgICBodHRwOi8vKgovLyBAaW5jbHVkZSAgICAgIGh0dHBzOi8vKgovLyBAcnVuLWF0ICAgICAgIGRvY3VtZW50LXN0YXJ0Ci8vIEBub2ZyYW1lcwovLyBAZ3JhbnQgICAgICAgIG5vbmUKLy8gPT0vVXNlclNjcmlwdD09CgooZnVuY3Rpb24oKSB7CiAgICAndXNlIHN0cmljdCc7CiAgICBpZiAod2luZG93Ll90dGlQb2x5ZmlsbExvYWRlZCkgcmV0dXJuOwogICAgd2luZG93Ll90dGlQb2x5ZmlsbExvYWRlZCA9IHRydWU7CgogICAgY29uc29sZS5sb2coInR0aSB1c2Vyc2NyaXB0IHJ1bm5pbmciKTsKICAgIChmdW5jdGlvbigpIHsKLy8gVE9ETzogSGF2ZSBhIGJldHRlciBtb2R1bGluZyBzeXN0ZW0KCndpbmRvdy5fRmlyc3RJbnRlcmFjdGl2ZUNvcmUgPSAoZnVuY3Rpb24oKSB7CiAgZnVuY3Rpb24gY29tcHV0ZUZpcnN0Q29uc2lzdGVudGx5SW50ZXJhY3RpdmUoCiAgICAgIHNlYXJjaFN0YXJ0LCBtaW5WYWx1ZSwgbGFzdEtub3duTmV0d29yazJCdXN5LCBjdXJyZW50VGltZSwgbG9uZ1Rhc2tzKSB7CgogICAgLy8gSGF2ZSBub3QgcmVhY2hlZCBuZXR3b3JrIDItcXVpZXQgeWV0LgogICAgaWYgKChjdXJyZW50VGltZSAtIGxhc3RLbm93bk5ldHdvcmsyQnVzeSkgPCA1MDAwKSByZXR1cm4gbnVsbDsKICAgIGNvbnN0IG1heWJlRkNJID0gbG9uZ1Rhc2tzLmxlbmd0aCA9PT0gMCA/CiAgICAgICAgICBzZWFyY2hTdGFydCA6IGxvbmdUYXNrc1tsb25nVGFza3MubGVuZ3RoIC0gMV0uZW5kOwoKICAgIC8vIE1haW4gdGhyZWFkIGhhcyBub3QgYmVlbiBxdWlldCBmb3IgbG9uZyBlbm91Z2guCiAgICBpZiAoY3VycmVudFRpbWUgLSBtYXliZUZDSSA8IDUwMDApIHJldHVybiBudWxsOwoKICAgIHJldHVybiBNYXRoLm1heChtYXliZUZDSSwgbWluVmFsdWUpOwogIH0KCiAgZnVuY3Rpb24gY29tcHV0ZUxhc3RLbm93bk5ldHdvcmsyQnVzeShpbmNvbXBsZXRlUmVxdWVzdFN0YXJ0cywgb2JzZXJ2ZWRSZXNvdXJjZVJlcXVlc3RzLCBjdXJyZW50VGltZSkgewogICAgaWYgKGluY29tcGxldGVSZXF1ZXN0U3RhcnRzLmxlbmd0aCA+IDIpIHJldHVybiBjdXJyZW50VGltZTsKCiAgICBjb25zdCBlbmRwb2ludHMgPSBbXTsKICAgIGZvciAoY29uc3QgcmVxIG9mIG9ic2VydmVkUmVzb3VyY2VSZXF1ZXN0cykgewogICAgICBlbmRwb2ludHMucHVzaCh7CiAgICAgICAgdGltZXN0YW1wOiByZXEuc3RhcnQsCiAgICAgICAgdHlwZTogJ3JlcXVlc3RTdGFydCcKICAgICAgfSk7CiAgICAgIGVuZHBvaW50cy5wdXNoKHsKICAgICAgICB0aW1lc3RhbXA6IHJlcS5lbmQsCiAgICAgICAgdHlwZTogJ3JlcXVlc3RFbmQnCiAgICAgIH0pOwogICAgfQoKICAgIGZvciAoY29uc3QgdHMgb2YgaW5jb21wbGV0ZVJlcXVlc3RTdGFydHMpIHsKICAgICAgZW5kcG9pbnRzLnB1c2goewogICAgICAgIHRpbWVzdGFtcDogdHMsCiAgICAgICAgdHlwZTogJ3JlcXVlc3RTdGFydCcKICAgICAgfSk7CiAgICB9CgogICAgZW5kcG9pbnRzLnNvcnQoKGEsIGIpID0+IGEudGltZXN0YW1wIC0gYi50aW1lc3RhbXApOwoKICAgIGxldCBjdXJyZW50QWN0aXZlID0gaW5jb21wbGV0ZVJlcXVlc3RTdGFydHMubGVuZ3RoOwoKICAgIGZvciAobGV0IGkgPSBlbmRwb2ludHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgY29uc3QgZW5kcG9pbnQgPSBlbmRwb2ludHNbaV07CiAgICAgIHN3aXRjaCAoZW5kcG9pbnQudHlwZSkgewogICAgICBjYXNlICdyZXF1ZXN0U3RhcnQnOgogICAgICAgIGN1cnJlbnRBY3RpdmUtLTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncmVxdWVzdEVuZCc6CiAgICAgICAgY3VycmVudEFjdGl2ZSsrOwogICAgICAgIGlmIChjdXJyZW50QWN0aXZlID4gMikgewogICAgICAgICAgcmV0dXJuIGVuZHBvaW50LnRpbWVzdGFtcDsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgRXJyb3IoIkludGVybmFsIEVycm9yOiBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4iKTsKICAgICAgfQogICAgfQoKICAgIC8vIElmIHdlIHJlYWNoIGhlcmUsIHdlIHdlcmUgbmV2ZXIgbmV0d29yayAyLWJ1c3kuCiAgICByZXR1cm4gMDsKICB9CgogIHJldHVybiB7CiAgICBjb21wdXRlRmlyc3RDb25zaXN0ZW50bHlJbnRlcmFjdGl2ZSwKICAgIGNvbXB1dGVMYXN0S25vd25OZXR3b3JrMkJ1c3kKICB9Owp9KSgpOwovLyBUT0RPOiBIYXZlIGEgYmV0dGVyIG1vZHVsaW5nIHN5c3RlbQoKd2luZG93Ll9BY3Rpdml0eVRyYWNrZXJVdGlscyA9IChmdW5jdGlvbigpIHsKICAgIGNsYXNzIENvdW50ZXIgewogICAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgICB0aGlzLl9jb3VudCA9IDA7CiAgICAgIH0KCiAgICAgIG5leHQoKSB7CiAgICAgICAgdGhpcy5fY291bnQrKzsKICAgICAgICByZXR1cm4gdGhpcy5fY291bnQ7CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCByZXF1ZXN0Q291bnRlciA9IG5ldyBDb3VudGVyKCk7CgogICAgZnVuY3Rpb24gcGF0Y2hYTUxIVFRQUmVxdWVzdChiZWZvcmVYSFJTZW5kQ2IsIG9uUmVxdWVzdENvbXBsZXRlZENiKSB7CiAgICAgIGNvbnN0IHNlbmQgPSBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUuc2VuZDsKICAgICAgY29uc3QgcmVxdWVzdElkID0gcmVxdWVzdENvdW50ZXIubmV4dCgpOwogICAgICBYTUxIdHRwUmVxdWVzdC5wcm90b3R5cGUuc2VuZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIGJlZm9yZVhIUlNlbmRDYihyZXF1ZXN0SWQpOwogICAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcigncmVhZHlzdGF0ZWNoYW5nZScsIGUgPT4gewogICAgICAgICAgLy8gcmVhZHlTdGF0ZSA0IGNvcnJlc3BvbmRzIHRvICdET05FJwogICAgICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PT0gNCkgb25SZXF1ZXN0Q29tcGxldGVkQ2IocmVxdWVzdElkKTsKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gc2VuZC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdGNoRmV0Y2goYmVmb3JlUmVxdWVzdENiLCBhZnRlclJlcXVlc3RDYil7CiAgICAgIGNvbnN0IG9yaWdpbmFsRmV0Y2ggPSBmZXRjaDsKICAgICAgZmV0Y2ggPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgY29uc29sZS5sb2coIk5ldyBmZXRjaCBydW5uaW5nIik7CiAgICAgICAgICBjb25zdCByZXF1ZXN0SWQgPSByZXF1ZXN0Q291bnRlci5uZXh0KCk7CiAgICAgICAgICBiZWZvcmVSZXF1ZXN0Q2IocmVxdWVzdElkKTsKICAgICAgICAgIG9yaWdpbmFsRmV0Y2guYXBwbHkodGhpcywgYXJndW1lbnRzKS50aGVuKAogICAgICAgICAgICB2YWx1ZSA9PiB7CiAgICAgICAgICAgICAgYWZ0ZXJSZXF1ZXN0Q2IocmVxdWVzdElkKTsKICAgICAgICAgICAgICByZXNvbHZlKHZhbHVlKTsKICAgICAgICAgICAgfSwKICAgICAgICAgICAgZSA9PiB7CiAgICAgICAgICAgICAgYWZ0ZXJSZXF1ZXN0Q2IoZSk7CiAgICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgICB9CiAgICAgICAgICApOwogICAgICAgIH0pOwogICAgICB9OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdGNoRG9jdW1lbnRXcml0ZShkb2NXcml0ZUNiKSB7CiAgICAgIGNvbnN0IHdyaXRlID0gRG9jdW1lbnQucHJvdG90eXBlLndyaXRlOwogICAgICBEb2N1bWVudC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbigpIHsKICAgICAgICBkb2NXcml0ZUNiKGFyZ3VtZW50cyk7CiAgICAgICAgcmV0dXJuIHdyaXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH07CiAgICB9CgogIHJldHVybiB7CiAgICBwYXRjaFhNTEhUVFBSZXF1ZXN0LAogICAgcGF0Y2hGZXRjaCwKICAgIHBhdGNoRG9jdW1lbnRXcml0ZQogIH07Cn0pKCk7Ci8vIFRPRE86IEhhdmUgYSBiZXR0ZXIgbW9kdWxpbmcgc3lzdGVtCgpjb25zdCBBY3Rpdml0eVRyYWNrZXJVdGlscyA9IHdpbmRvdy5fQWN0aXZpdHlUcmFja2VyVXRpbHM7CmNvbnN0IEZpcnN0SW50ZXJhY3RpdmVDb3JlID0gd2luZG93Ll9GaXJzdEludGVyYWN0aXZlQ29yZTsKCndpbmRvdy5fZmlyc3RJbnRlcmFjdGl2ZURldGVjdG9yID0gKGZ1bmN0aW9uKCkgewogIGNsYXNzIEZpcnN0SW50ZXJhY3RpdmVEZXRlY3RvciB7CiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuX2RlYnVnTW9kZSA9IG9wdGlvbnMuZGVidWdNb2RlIHx8IGZhbHNlOwogICAgICB0aGlzLl90aW1lcklkID0gbnVsbDsKICAgICAgdGhpcy5fdGltZXJBY3RpdmF0aW9uVGltZSA9IC1JbmZpbml0eTsKCiAgICAgIHRoaXMuX25ldHdvcmtSZXF1ZXN0cyA9IFtdOwogICAgICB0aGlzLl9sb25nVGFza3MgPSBbXTsKICAgICAgdGhpcy5faW5jb21wbGV0ZUpTSW5pdGlhdGVkUmVxdWVzdFN0YXJ0VGltZXMgPSBuZXcgTWFwKCk7CiAgICAgIC8vIElmIG1pblZhbHVlIGlzIG51bGwsIGJ5IGRlZmF1bHQgaXQgaXMgRE9NQ29udGVudExvYWRlZEVuZC4KICAgICAgdGhpcy5fbWluVmFsdWUgPSBudWxsOwoKICAgICAgLy8gVGltZXIgdGFza3MgYXJlIG9ubHkgc2NoZWR1bGVkIHdoZW4gZGV0ZWN0b3IgaXMgZW5hYmxlZC4KICAgICAgdGhpcy5fc2NoZWR1bGVUaW1lclRhc2tzID0gZmFsc2U7CiAgICAgIHRoaXMuX3JlZ2lzdGVyaXN0ZW5lcnMoKTsKICAgIH0KCiAgICBzdGFydFNjaGVkdWxpbmdUaW1lclRhc2tzKCkgewogICAgICB0aGlzLl9kZWJ1Z0xvZygiRW5hYmxpbmcgRmlyc3RJbnRlcmFjdGl2ZURldGVjdG9yIik7CiAgICAgIHRoaXMuX3NjaGVkdWxlVGltZXJUYXNrcyA9IHRydWU7CiAgICAgIHRoaXMucmVzY2hlZHVsZVRpbWVyKEZpcnN0SW50ZXJhY3RpdmVDb3JlLmNvbXB1dGVMYXN0S25vd25OZXR3b3JrMkJ1c3kodGhpcy5faW5jb21wbGV0ZVJlcXVlc3RTdGFydHMsIHRoaXMuX25ldHdvcmtSZXF1ZXN0cykgKyA1MDAwKTsKICAgIH0KCiAgICBzZXRNaW5WYWx1ZShtaW5WYWx1ZSkgewogICAgICB0aGlzLl9taW5WYWx1ZSA9IG1pblZhbHVlOwogICAgfQoKICAgIC8vIGVhcmxpc3RUaW1lIGlzIGEgdGltZXN0YW1wIGluIG1zLCBhbmQgdGhlIHRpbWUgaXMgcmVsYXRpdmUgdG8gbmF2aWdhdGlvblN0YXJ0LgogICAgcmVzY2hlZHVsZVRpbWVyKGVhcmxpZXN0VGltZSkgewogICAgICAvLyBDaGVjayBpZiByZWFkeSB0byBzdGFydCBsb29raW5nIGZvciBmaXJzdEludGVyYWN0aXZlCiAgICAgIGlmICghdGhpcy5fc2NoZWR1bGVUaW1lclRhc2tzKSB7CiAgICAgICAgdGhpcy5fZGVidWdMb2coInN0YXJ0U2NoZWR1bGluZ1RpbWVyVGFza3MgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIGNhbGxpbmcgcmVzY2hlZHVsZVRpbWVyIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICB0aGlzLl9kZWJ1Z0xvZygiQXR0ZW1wdGluZyB0byByZXNjaGVkdWxlIEZpcnN0SW50ZXJhY3RpdmUgY2hlY2sgdG8gIiwgZWFybGllc3RUaW1lKTsKICAgICAgdGhpcy5fZGVidWdMb2coIlByZXZpb3VzIHRpbWVyIGFjdGl2YXRpb24gdGltZTogIiwgdGhpcy5fdGltZXJBY3RpdmF0aW9uVGltZSk7CgogICAgICBpZiAodGhpcy5fdGltZXJBY3RpdmF0aW9uVGltZSA+IGVhcmxpZXN0VGltZSkgewogICAgICAgIHRoaXMuX2RlYnVnTG9nKCJDdXJyZW50IGFjdGl2YXRpb24gdGltZSBpcyBncmVhdGVyIHRoYW4gYXR0ZW1wdGVkIHJlc2NoZWR1bGUgdGltZS4gTm8gbmVlZCB0byBwb3N0cG9uZS4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVySWQpOwogICAgICB0aGlzLl90aW1lcklkID0gc2V0VGltZW91dCgoKSA9PiB0aGlzLl9jaGVja1RUSSgpLCBlYXJsaWVzdFRpbWUgLSBwZXJmb3JtYW5jZS5ub3coKSk7CiAgICAgIHRoaXMuX3RpbWVyQWN0aXZhdGlvblRpbWUgPSBlYXJsaWVzdFRpbWU7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJSZXNjaGVkdWxlZCBmaXJzdEludGVyYWN0aXZlIGNoZWNrIGF0ICIsIGVhcmxpZXN0VGltZSk7CiAgICB9CgogICAgZGlzYWJsZSgpIHsKICAgICAgdGhpcy5fZGVidWdMb2coIkRpc2FibGluZyBGaXJzdEludGVyYWN0aXZlRGV0ZWN0b3IiKTsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVySWQpOwogICAgICB0aGlzLl9zY2hlZHVsZVRpbWVyVGFza3MgPSBmYWxzZTsKICAgICAgdGhpcy5fdW5yZWdpc3Rlckxpc3RlbmVycygpOwogICAgfQoKICAgIF9kZWJ1Z0xvZygpIHsKICAgICAgaWYgKHRoaXMuX2RlYnVnTW9kZSkgewogICAgICAgIGNvbnNvbGUubG9nKC4uLmFyZ3VtZW50cyk7CiAgICAgIH0KICAgIH0KCiAgICBfcmVnaXN0ZXJQZXJmb3JtYW5jZU9ic2VydmVyKCkgewogICAgICBjb25zdCBmaXJzdEludGVyYWN0aXZlRGV0ZWN0b3IgPSB0aGlzOwogICAgICB0aGlzLl9wZXJmb3JtYW5jZU9ic2VydmVyID0gbmV3IFBlcmZvcm1hbmNlT2JzZXJ2ZXIoZnVuY3Rpb24oZW50cnlMaXN0KSB7CiAgICAgICAgdmFyIGVudHJpZXMgPSBlbnRyeUxpc3QuZ2V0RW50cmllcygpOwogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZW50cmllcykgewogICAgICAgICAgaWYgKGVudHJ5LmVudHJ5VHlwZSA9PT0gJ3Jlc291cmNlJykgewogICAgICAgICAgICBmaXJzdEludGVyYWN0aXZlRGV0ZWN0b3IuX25ldHdvcmtSZXF1ZXN0RmluaXNoZWRDYWxsYmFjayhlbnRyeSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoZW50cnkuZW50cnlUeXBlID09PSAibG9uZ3Rhc2siKSB7CiAgICAgICAgICAgIGZpcnN0SW50ZXJhY3RpdmVEZXRlY3Rvci5fbG9uZ1Rhc2tGaW5pc2hlZENhbGxiYWNrKGVudHJ5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICB0aGlzLl9wZXJmb3JtYW5jZU9ic2VydmVyLm9ic2VydmUoe2VudHJ5VHlwZXM6IFsibG9uZ3Rhc2siLCAicmVzb3VyY2UiXX0pOwogICAgfQoKICAgIF9yZWdpc3RlcmlzdGVuZXJzKCkgewogICAgICBBY3Rpdml0eVRyYWNrZXJVdGlscy5wYXRjaFhNTEhUVFBSZXF1ZXN0KHRoaXMuX2JlZm9yZUpTSW5pdGlhdGVkUmVxdWVzdENhbGxiYWNrLmJpbmQodGhpcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWZ0ZXJKU0luaXRpYXRlZFJlcXVlc3RDYWxsYmFjay5iaW5kKHRoaXMpKTsKICAgICAgQWN0aXZpdHlUcmFja2VyVXRpbHMucGF0Y2hGZXRjaCh0aGlzLl9iZWZvcmVKU0luaXRpYXRlZFJlcXVlc3RDYWxsYmFjay5iaW5kKHRoaXMpLAogICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVySlNJbml0aWF0ZWRSZXF1ZXN0Q2FsbGJhY2suYmluZCh0aGlzKSk7CiAgICAgIEFjdGl2aXR5VHJhY2tlclV0aWxzLnBhdGNoRG9jdW1lbnRXcml0ZSh0aGlzLl9iZWZvcmVEb2N1bWVudFdyaXRlQ2FsbGJhY2suYmluZCh0aGlzKSk7CiAgICAgIHRoaXMuX3JlZ2lzdGVyUGVyZm9ybWFuY2VPYnNlcnZlcigpOwogICAgfQoKICAgIF91bnJlZ2lzdGVyTGlzdGVuZXJzKCkgewogICAgICAvLyBXZSB3aWxsIGxlYXZlIHRoZSBYSFIgLyBGZXRjaCAvIERvY1dyaXRlIG9iamVjdHMgdGhlIHdheSB0aGV5IHdlcmUsCiAgICAgIC8vIHNpbmNlIHdlIGNhbm5vdCBndWFyYW50ZWUgdGhleSB3ZXJlIG5vdCBtb2RpZmllZCBmdXJ0aGVyIGluIGJldHdlZW4uCiAgICAgIC8vIE9ubHkgdW5yZWdpc3RlciBwZXJmb3JtYW5jZSBvYnNlcnZlcnMuCiAgICAgIGlmICh0aGlzLl9wZXJmb3JtYW5jZU9ic2VydmVyKSB0aGlzLl9wZXJmb3JtYW5jZU9ic2VydmVyLmRpc2Nvbm5lY3QoKTsKICAgIH0KCiAgICBfYmVmb3JlSlNJbml0aWF0ZWRSZXF1ZXN0Q2FsbGJhY2socmVxdWVzdElkKSB7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJTdGFydGluZyBKUyBpbml0aWF0ZWQgcmVxdWVzdC4gUmVxdWVzdCBJRDogIiwgcmVxdWVzdElkKTsKICAgICAgdGhpcy5faW5jb21wbGV0ZUpTSW5pdGlhdGVkUmVxdWVzdFN0YXJ0VGltZXMuc2V0KHJlcXVlc3RJZCwgcGVyZm9ybWFuY2Uubm93KCkpOwogICAgICB0aGlzLl9kZWJ1Z0xvZygiQWN0aXZlIFhIUnM6ICIsIHRoaXMuX2luY29tcGxldGVKU0luaXRpYXRlZFJlcXVlc3RTdGFydFRpbWVzLnNpemUpOwogICAgfQoKICAgIF9hZnRlckpTSW5pdGlhdGVkUmVxdWVzdENhbGxiYWNrKHJlcXVlc3RJZCkgewogICAgICB0aGlzLl9kZWJ1Z0xvZygiQ29tcGxldGVkIEpTIGluaXRpYXRlZCByZXF1ZXN0IHdpdGggcmVxdWVzdCBJRDogIiwgcmVxdWVzdElkKTsKICAgICAgdGhpcy5faW5jb21wbGV0ZUpTSW5pdGlhdGVkUmVxdWVzdFN0YXJ0VGltZXMuZGVsZXRlKHJlcXVlc3RJZCk7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJBY3RpdmUgWEhSczogIiwgdGhpcy5faW5jb21wbGV0ZUpTSW5pdGlhdGVkUmVxdWVzdFN0YXJ0VGltZXMuc2l6ZSk7CiAgICB9CgogICAgX2JlZm9yZURvY3VtZW50V3JpdGVDYWxsYmFjaygpIHsKICAgICAgdGhpcy5fZGVidWdMb2coIkRvY3VtZW50LndyaXRlIGNhbGwgZGV0ZWN0ZWQuIFB1c2hpbmcgYmFjayBGaXJzdEludGVyYWN0aXZlIGNoZWNrIGJ5IDUgc2Vjb25kcy4iKTsKICAgICAgZmlyc3RJbnRlcmFjdGl2ZURldGVjdG9yLnJlc2NoZWR1bGVUaW1lcihwZXJmb3JtYW5jZS5ub3coKSArIDUwMDApOwogICAgfQoKICAgIF9uZXR3b3JrUmVxdWVzdEZpbmlzaGVkQ2FsbGJhY2socGVyZm9ybWFuY2VFbnRyeSkgewogICAgICB0aGlzLl9kZWJ1Z0xvZygiTmV0d29yayByZXF1ZXN0IGZpbmlzaGVkOiAiLCBwZXJmb3JtYW5jZUVudHJ5KTsKICAgICAgdGhpcy5fbmV0d29ya1JlcXVlc3RzLnB1c2goewogICAgICAgIHN0YXJ0OiBwZXJmb3JtYW5jZUVudHJ5LmZldGNoU3RhcnQsCiAgICAgICAgZW5kOiBwZXJmb3JtYW5jZUVudHJ5LnJlc3BvbnNlRW5kCiAgICAgIH0pOwogICAgICB0aGlzLnJlc2NoZWR1bGVUaW1lcigKICAgICAgICBGaXJzdEludGVyYWN0aXZlQ29yZS5jb21wdXRlTGFzdEtub3duTmV0d29yazJCdXN5KHRoaXMuX2luY29tcGxldGVSZXF1ZXN0U3RhcnRzLCB0aGlzLl9uZXR3b3JrUmVxdWVzdHMpICsgNTAwMCk7CiAgICB9CgogICAgX2xvbmdUYXNrRmluaXNoZWRDYWxsYmFjayhwZXJmb3JtYW5jZUVudHJ5KSB7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJMb25nIHRhc2sgZmluaXNoZWQ6ICIsIHBlcmZvcm1hbmNlRW50cnkpOwogICAgICBjb25zdCB0YXNrRW5kVGltZSA9IHBlcmZvcm1hbmNlRW50cnkuc3RhcnRUaW1lICsKICAgICAgICAgICAgcGVyZm9ybWFuY2VFbnRyeS5kdXJhdGlvbjsKICAgICAgdGhpcy5fbG9uZ1Rhc2tzLnB1c2goewogICAgICAgIHN0YXJ0OiBwZXJmb3JtYW5jZUVudHJ5LnN0YXJ0VGltZSwKICAgICAgICBlbmQ6IHRhc2tFbmRUaW1lCiAgICAgIH0pOwogICAgICB0aGlzLnJlc2NoZWR1bGVUaW1lcih0YXNrRW5kVGltZSArIDUwMDApOwogICAgfQoKICAgIF9nZXRNaW5WYWx1ZSgpIHsKICAgICAgaWYgKHRoaXMuX21pblZhbHVlKSByZXR1cm4gdGhpcy5fbWluVmFsdWU7CgogICAgICBpZiAocGVyZm9ybWFuY2UudGltaW5nLmRvbUNvbnRlbnRMb2FkZWRFdmVudEVuZCkgewogICAgICAgIHJldHVybiBwZXJmb3JtYW5jZS50aW1pbmcuZG9tQ29udGVudExvYWRlZEV2ZW50RW5kIC0gcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydDsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgZ2V0IF9pbmNvbXBsZXRlUmVxdWVzdFN0YXJ0cygpIHsKICAgICAgcmV0dXJuIFsuLi50aGlzLl9pbmNvbXBsZXRlSlNJbml0aWF0ZWRSZXF1ZXN0U3RhcnRUaW1lcy52YWx1ZXMoKV0KICAgIH0KCiAgICBfY2hlY2tUVEkoKSB7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJDaGVja2luZyBpZiBGaXJzdCBJbnRlcmFjdGl2ZSB3YXMgcmVhY2hlZC4uLiIpOwogICAgICBjb25zdCBuYXZpZ2F0aW9uU3RhcnQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgICBjb25zdCBsYXN0QnVzeSA9IEZpcnN0SW50ZXJhY3RpdmVDb3JlLmNvbXB1dGVMYXN0S25vd25OZXR3b3JrMkJ1c3kodGhpcy5faW5jb21wbGV0ZVJlcXVlc3RTdGFydHMsIHRoaXMuX25ldHdvcmtSZXF1ZXN0cyk7CiAgICAgIGNvbnN0IGZpcnN0UGFpbnQgPSBjaHJvbWUubG9hZFRpbWVzKCkuZmlyc3RQYWludFRpbWU7CiAgICAgIC8vIElmIGZpcnN0UGFpbnQgaXMgbm90IHNldCB5ZXQsIHNlYXJjaFN0YXJ0IGlzIG5hdmlnYXRpb25TdGFydC4KICAgICAgY29uc3Qgc2VhcmNoU3RhcnQgPSBmaXJzdFBhaW50ID09PSAwID8gMCA6IGNocm9tZS5sb2FkVGltZXMoKS5maXJzdFBhaW50VGltZSAqIDEwMDAgLSBuYXZpZ2F0aW9uU3RhcnQ7CiAgICAgIGNvbnN0IG1pblZhbHVlID0gdGhpcy5fZ2V0TWluVmFsdWUoKTsKICAgICAgY29uc3QgY3VycmVudFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTsKCiAgICAgIC8vIElkZWFsbHkgd2Ugd2lsbCBvbmx5IHN0YXJ0IHNjaGVkdWxpbmcgdGltZXJzIGFmdGVyIERPTUNvbnRlbnRMb2FkZWQgYW5kCiAgICAgIC8vIHRoaXMgY2FzZSBzaG91bGQgbmV2ZXIgYmUgaGl0LgogICAgICBpZiAobWluVmFsdWUgPT09IG51bGwpIHsKICAgICAgICB0aGlzLl9kZWJ1Z0xvZygiTm8gdXNhYmxlIG1pbmltdW0gdmFsdWUgeWV0LiBQb3N0cG9uaW5nIGNoZWNrLiIpOwogICAgICAgIHRoaXMucmVzY2hlZHVsZVRpbWVyKE1hdGgubWF4KGxhc3RCdXN5ICsgNTAwMCwgcGVyZm9ybWFuY2Uubm93KCkgKyAxMDAwKSk7CiAgICAgIH0KCiAgICAgIHRoaXMuX2RlYnVnTG9nKCJQYXJhbWV0ZXIgdmFsdWVzOiAiKTsKICAgICAgdGhpcy5fZGVidWdMb2coIk5hdmlnYXRpb25TdGFydDogIiwgbmF2aWdhdGlvblN0YXJ0KTsKICAgICAgdGhpcy5fZGVidWdMb2coImxhc3RLbm93bk5ldHdvcmsyQnVzeTogIiwgbGFzdEJ1c3kpOwogICAgICB0aGlzLl9kZWJ1Z0xvZygiU2VhcmNoIFN0YXJ0OiAiLCBzZWFyY2hTdGFydCk7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJNaW4gVmFsdWU6ICIsIG1pblZhbHVlKTsKICAgICAgdGhpcy5fZGVidWdMb2coIkxhc3QgYnVzeTogIiwgbGFzdEJ1c3kpOwogICAgICB0aGlzLl9kZWJ1Z0xvZygiQ3VycmVudCB0aW1lOiAiLCBjdXJyZW50VGltZSk7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJMb25nIHRhc2tzOiAiLCB0aGlzLl9sb25nVGFza3MpOwogICAgICB0aGlzLl9kZWJ1Z0xvZygiSW5jb21wbGV0ZSBKUyBSZXF1ZXN0IFN0YXJ0IFRpbWVzOiAiLCB0aGlzLl9pbmNvbXBsZXRlUmVxdWVzdFN0YXJ0cyk7CiAgICAgIHRoaXMuX2RlYnVnTG9nKCJOZXR3b3JrIHJlcXVlc3RzOiAiLCB0aGlzLl9uZXR3b3JrUmVxdWVzdHMpOwoKICAgICAgY29uc3QgbWF5YmVGQ0kgPSBGaXJzdEludGVyYWN0aXZlQ29yZS5jb21wdXRlRmlyc3RDb25zaXN0ZW50bHlJbnRlcmFjdGl2ZSgKICAgICAgICAgIHNlYXJjaFN0YXJ0LCBtaW5WYWx1ZSwgbGFzdEJ1c3ksIGN1cnJlbnRUaW1lLCB0aGlzLl9sb25nVGFza3MpOwogICAgICBpZiAobWF5YmVGQ0kpIHsKICAgICAgICBjb25zb2xlLmxvZygiRmlyc3QgaW50ZXJhY3RpdmUgZm91bmQ6ICIsIG1heWJlRkNJKTsKICAgICAgICB0aGlzLmRpc2FibGUoKTsKICAgICAgICByZXR1cm4gbWF5YmVGQ0k7CiAgICAgIH0KCiAgICAgIC8vIEZpcnN0IEludGVyYWN0aXZlIHdhcyBub3QgcmVhY2hlZCBmb3Igd2hhdGV2ZXIgcmVhc29ucy4gQ2hlY2sgYWdhaW4gaW4KICAgICAgLy8gb25lIHNlY29uZC4KICAgICAgLy8gRXZlbnR1YWxseSB3ZSBzaG91bGQgYmVjb21lIGNvbmZpZGVudCBlbm91Z2ggaW4gb3VyIHNjaGVkdWxlciBsb2dpYyB0bwogICAgICAvLyBnZXQgcmlkIG9mIHRoaXMgc3RlcC4KICAgICAgdGhpcy5fZGVidWdMb2coIkNvdWxkIG5vdCBkZXRlY3QgRmlyc3QgSW50ZXJhY3RpdmUuIFJldHJ5aW5nIGluIDEgc2Vjb25kLiIpOwogICAgICB0aGlzLnJlc2NoZWR1bGVUaW1lcihwZXJmb3JtYW5jZS5ub3coKSArIDEwMDApOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIEZpcnN0SW50ZXJhY3RpdmVEZXRlY3RvciwKICB9Owp9KSgpOwpjb25zb2xlLmxvZygiTG9hZGluZyBUaW1lIHRvIEludGVyYWN0aXZlIFBvbHlmaWxsIik7CgooZnVuY3Rpb24oKSB7CgogIC8vIFNldCBhIG1hcmtlciBhdCBhcm91bmQgMSBzZWNvbmQgaXQgaXMgc2xpZ2h0bHkgZWFzaWVyIGluIGRldnRvb2xzIHRpbWVsaW5lCiAgLy8gdG8gc2VlIHdoZXJlIEZpcnN0SW50ZXJhY3RpdmUgZmlyZWQuCiAgc2V0VGltZW91dCgoKSA9PiB7CiAgICBjb25zb2xlLmxvZygiU2V0dGluZyBhIG1hcmtlciBmb3IgMSBzZWNvbmQiKTsKICAgIGNvbnNvbGUudGltZVN0YW1wKCJSb3VnaGx5IDFzIG1hcmsiKTsKICB9LCAxMDAwKTsKCiAgY29uc3QgQWN0aXZpdHlUcmFja2VyVXRpbHMgPSB3aW5kb3cuX0FjdGl2aXR5VHJhY2tlclV0aWxzOwogIGNvbnN0IEZpcnN0SW50ZXJhY3RpdmVDb3JlID0gd2luZG93Ll9GaXJzdEludGVyYWN0aXZlQ29yZTsKICBjb25zdCBGaXJzdEludGVyYWN0aXZlRGV0ZWN0b3IgPSB3aW5kb3cuX2ZpcnN0SW50ZXJhY3RpdmVEZXRlY3Rvci5GaXJzdEludGVyYWN0aXZlRGV0ZWN0b3I7CgogIGNvbnN0IGZpcnN0SW50ZXJhY3RpdmVEZXRlY3RvciA9IG5ldyBGaXJzdEludGVyYWN0aXZlRGV0ZWN0b3Ioe2RlYnVnTW9kZTogdHJ1ZX0pOwoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4gewogICAgY29uc29sZS5sb2coIkRPTSBDb250ZW50IExvYWRlZCBmaXJlZCAtIHNjaGVkdWxpbmcgRmlyc3RJbnRlcmFjdGl2ZSB0aW1lciB0YXNrcyIpOwogICAgLy8gZmlyc3RJbnRlcmFjdGl2ZURldGVjdG9yLnNldE1pblZhbHVlKDIwMDAwKTsKICAgIGZpcnN0SW50ZXJhY3RpdmVEZXRlY3Rvci5zdGFydFNjaGVkdWxpbmdUaW1lclRhc2tzKCk7CiAgfSk7Cgp9KSgpOwogICAgfSkoKTsKfSkoKTsK"}]}